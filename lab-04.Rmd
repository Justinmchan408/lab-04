---
title: "Lab-04"
author: "Justin Chan"
date: "2/10/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Lab 4

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(knitr)
library(broom)
library(ggplot2)
```

### Exploratory Data Analysis

1. Create a new data frame that is a subset of diamonds that weigh 0.5 carats. 
How many observations are in the new dataset?

```{r data, include=T}
diamonds_0.5_carat <- ggplot2::diamonds %>% 
  filter(carat == 0.5)

glimpse(diamonds_0.5_carat)
```

In the new dataset, there are 1,258 rows or diamonds that are 0.5 carats in the dataset that have 10 columns or features about those diamonds.

2. When using Analysis of Variance (ANOVA) to compare group means, it is ideal to have approximately the same number of observations for each group. Which two levels of cut have the fewest number of observations? Show the code and output used to support your answer.

```{r cut counts, include=T}
diamonds_0.5_carat %>% 
  group_by(cut) %>% 
  tally()
```

Based on Exercise 2, the two levels of cut that have the fewest observations or 
diamonds in the dataset is Fair with 80 diamonds and Good with 181 diamonds.

3. Confirm that the variable cut was recoded as expected. Show the code and 
output used to check the recoding.
```{r cut combined, include=T}
diamonds_cut_reduced <- diamonds_0.5_carat %>%
  mutate(cut = fct_lump(cut, n = 3))

diamonds_cut_reduced %>% 
  count(cut)
```

4. Create a plot to display the relationship between cut and price. Be sure to include informative axes labels and an informative title.
```{r cut price relationship, include=T}
ggplot(data = diamonds_cut_reduced, aes(x = cut, y = price)) + 
  geom_boxplot() +
  labs(title = "Price Distrib per Cut",
       x = "Cut",
       y = "Price")
```

5. Calculate the number of observations along with the mean and standard deviation of price for each level of cut.

```{r price statistics by cut, include=T}
diamonds_cut_reduced %>% 
  group_by(cut) %>% 
  summarise(count = n(),
            price_mean = mean(price), 
            price_std_dev = sd(price)
            )
```

The cut group, Very Good, in the dataset has 332 observations, a price mean of 
1488.66 dollars and a price standard deviation of 339.36 dollars. The cut group,
Premium, in the dataset has 277 observations, a price mean of 1531.78 dollars
and a price standard deviation of 304.14 dollars. The cut group, Ideal, in the
dataset has 388 observations, a price mean of 1608.67 dollars and a price 
standard deviation of 368.34 dollars. The cut group, Other, in the dataset has
261 combined observations, a price mean of 1340.64 dollars and a price standard
deviation of 364.52 dollars.

6. Based on the plots and summary statistics from the previous exercises , does 
there appear to be a relationship between the cut and price for diamonds that 
are 0.5 carats? Briefly explain your reasoning.

Based on the plots and summary statistics from previous exercises, I do not
think there appears to be a direct correlation or relationship between with cut 
and price of diamonds of 0.5 carats. From the box plot in Exercise 4, there
does not seem a great difference in variation where each category has around
the same median across all cuts. Furthermore, the means from Exercise 5 are not
far from each other with the less than one standard deviations within each other
meaning that there is no clear correlation or relationship between cut and price.

### Analysis of Variance

7. When using ANOVA to compare means across groups, we make the following 
assumptions (note how similar they are to the assumptions for regression):

Normality: The distribution of the response, y, is approximately normal within 
each category of the predictor, x - in the ith category, the y’s follow a 
N(μi,σ2) distribution.

Independence: All observations are independent from one another, i.e. one 
observation does not affect another.

Constant Variance: The distribution of the response within each category of 
predictor, x has a common variance, σ2.

Are the assumptions for ANOVA satisfied? Comment on each assumption, including 
an explanation for your reasoning and any summary statistics and/or plots used 
to make the conclusion.

```{r cut normality, include=T}
ggplot(data = diamonds_cut_reduced, aes(x = price)) +
  geom_histogram() +
  facet_wrap(~cut) +
  labs(title = "Distribution of price per cut")
```

Yes, the assumptions for ANOVA are satisfied to run for this dataset of
diamonds of carat = 0.5. First, the independence condition is satisfied since
the selection of one diamond would not affect the selection of another diamond.
Furthermore, I do not think data collection of diamonds would affect each other.
Next, the Normality condition is satisfied in the dataset since each of the cut
categories is approximately Normal in being symmetrical and unimodal using the
graph above. Lastly, the constant variance is satisfied since the standard 
deviation of each cut category is about the same. From Exercise 5, all the 
different cut categories have a standard deviation of 304-368 dollars across 
each cut so constant variance is held across all diamond cuts.

8. Display the ANOVA table used to examine the relationship between cut 
and price for diamonds that are 0.5 carats.

```{r model, echo=T}
price_model <- lm(price ~ cut, data = diamonds_cut_reduced)
anova(price_model) %>% 
  kable(format = "markdown", digits = 3)
```


9. Use the ANOVA table from the previous question to calculate the sample 
variance of price. Show the code / formula used to calculate the sample 
variance.

When thinking about calculating the sample variance of the price, I would
want to calculate the total variation which can be calculated from class:
$$s_y^2 = \frac{SST}{DFT} = \frac{SSB + SSR}{n - 1} = \frac{11507056 + 150706506}{1258 - 1} = 129048.18$$

10. What is σ̂ 2, the estimated variance of price within each level of cut.
σ̂2 also known as MSW, the estimated variance of the price within each level
of cut is:
$$MSW = \frac{SSW}{DFW} = \frac{SSW}{n - K} = \frac{150706506}{1258 - 4} = 120180.627$$

11. State the null and alternative hypotheses for the test conducted using the ANOVA table in Exercise 8. State the hypotheses using both statistical notation and words in the context of the data.

Statistical Notation:
$$H_{0}: μ_{price,verygood} = μ_{price, premium} = μ_{price, ideal} = μ_{price, other}$$
Ha: At least one of the price means for each cut selection are not equal to the 
others.

Words:

Null Hypothesis: The mean price for each different cut of diamond that has a 
carat of 0.5 is equal to each other. In other words, mean price is about the 
same across all cuts where cut is not a factor in determining mean price.

Alternative Hypothesis: The mean price for at least one cut category out of the 
four that have a carat of 0.5 is not equal to the others. As long as one mean 
price is different from the others, then the alternative hypothesis is true 
which is attempting to imply that cut of diamond does play a factor in price for diamonds.

12. What is your conclusion for the test specified in the previous question? 
State the conclusion in the context of the data.

We can conclude that since the p-value is approximately 0, we can reject the 
null hypothesis that the mean prices among each cut groups are equal to each 
other. We can say that we are statistically confident that mean prices for
each diamond are not all equal to each other. The test assumed that the mean
price groups were all equal and gave the probability of observing our dataset
for diamonds with carats = 0.5 which is approximately 0. In context of the data,
we can say that at least of the cut groups have a statistically different mean 
price from the others where we cannot say that they all have the same mean 
price. It looks like conditional probabilities across cuts for mean price
differ for at least one cut group of diamonds since they do not all equal 
each other.

13. Based on the conclusion of the ANOVA test, conduct further statistical 
analysis to provide more detail about which level(s) is(are) different and by 
how much. If further statistical analysis is not required, provide a brief 
explanation why it isn’t based on the conclusion from the ANOVA test.

```{r additional analysis, echo=T}
tidy(price_model, conf.int = TRUE) %>% 
  kable(format = "markdown", digits = 3)

ideal_and_other <- diamonds_cut_reduced %>% filter(cut == "Other" | cut == "Ideal")
t.test(ideal_and_other$price ~ ideal_and_other$cut, alternative = "two.sided", conf.level = 0.95)

ideal_and_verygood <- diamonds_cut_reduced %>% filter(cut == "Very Good" | cut == "Ideal")
t.test(ideal_and_verygood$price ~ ideal_and_verygood$cut, alternative = "two.sided", conf.level = 0.95)

ideal_and_premium <- diamonds_cut_reduced %>% filter(cut == "Premium" | cut == "Ideal")
t.test(ideal_and_premium$price ~ ideal_and_premium$cut, alternative = "two.sided", conf.level = 0.95)

premium_and_other <- diamonds_cut_reduced %>% filter(cut == "Other" | cut == "Premium")
t.test(premium_and_other$price ~ premium_and_other$cut, alternative = "two.sided", conf.level = 0.95)

premium_and_verygood <- diamonds_cut_reduced %>% filter(cut == "Very Good" | cut == "Premium")
t.test(premium_and_verygood$price ~ premium_and_verygood$cut, alternative = "two.sided", conf.level = 0.95)

verygood_and_other <- diamonds_cut_reduced %>% filter(cut == "Very Good" | cut == "Other")
t.test(verygood_and_other$price ~ verygood_and_other$cut, alternative = "two.sided", conf.level = 0.95)
```

